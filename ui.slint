import { VerticalBox, HorizontalBox, Button } from "std-widgets.slint";

export struct CardUI {
    rank: string,
    suit: string,
    card_color: string,
    visible: bool,
}

export component MainWindow inherits Window {
    title: "Poker";
    width: 1000px;
    height: 700px;
    background: #0d1520;

    in property <int> pot;
    in property <int> current_bet;
    in property <string> phase_name;
    in property <string> current_player_name;
    in property <bool> show_actions;
    in property <bool> can_check;
    in property <bool> can_call;
    in property <bool> can_fold;
    in property <bool> can_raise;
    in property <int> min_raise_amount;
    in property <bool> animation_active;
    in property <bool> show_winner;
    in property <string> winner_name;

    in property <int> player_chips;
    in property <int> player_bet;
    in property <string> player_last_action;
    in property <int> bot_chips;
    in property <int> bot_bet;
    in property <string> bot_last_action;

    in property <[CardUI]> player_cards;
    in property <[CardUI]> bot_cards;
    in property <[CardUI]> community_cards;

    callback check();
    callback call();
    callback fold();
    callback raise();
    callback all_in();
    callback new_hand();

    VerticalBox {
        padding: 12px;
        spacing: 8px;

        HorizontalBox {
            padding: 8px;
            spacing: 20px;
            alignment: center;

            Text {
                text: "‚ô† ‚ô• ‚ô¶ ‚ô£ POKER ‚ô£ ‚ô¶ ‚ô• ‚ô†";
                font-size: 28px;
                font-weight: 800;
                color: #ffd700;
            }
        }

        HorizontalBox {
            padding: 4px;
            spacing: 24px;
            alignment: center;

            Text {
                text: "Pot: " + root.pot;
                font-size: 18px;
                color: #ffd700;
                font-weight: 600;
            }

            Text {
                text: root.phase_name;
                font-size: 20px;
                font-weight: 700;
                color: #ffffff;
            }

            if root.animation_active: Text {
                text: "‚óâ Simulating...";
                font-size: 16px;
                color: #00ff88;
                font-weight: 600;
            }
        }

        HorizontalBox {
            padding: 6px;
            spacing: 8px;
            alignment: center;

            VerticalBox {
                spacing: 4px;
                alignment: center;

                Text {
                    text: "Bot (AI)";
                    font-size: 16px;
                    font-weight: 700;
                    color: #ff6b6b;
                }

                HorizontalBox {
                    spacing: 4px;
                    alignment: center;

                    for card in root.bot_cards: HorizontalBox {
                        spacing: 2px;
                        Text {
                            text: "[" + card.rank + card.suit + "]";
                            font-size: 14px;
                            color: card.visible ? (card.card_color == "red" ? #cc2222 : #222266) : #2a5a3a;
                        }
                    }
                }

                HorizontalBox {
                    spacing: 12px;
                    alignment: center;

                    Text {
                        text: "Chips: " + root.bot_chips;
                        font-size: 13px;
                        color: #8ecdc4;
                    }

                    Text {
                        text: "Bet: " + root.bot_bet;
                        font-size: 13px;
                        color: #ffd700;
                    }
                }

                if root.bot_last_action != "": Text {
                    text: root.bot_last_action;
                    font-size: 11px;
                    color: #888888;
                    font-italic: true;
                }
            }

            VerticalBox {
                spacing: 4px;
                alignment: center;

                Text {
                    text: "COMMUNITY";
                    font-size: 14px;
                    color: #4a8a5a;
                    font-weight: 600;
                }

                HorizontalBox {
                    spacing: 4px;
                    alignment: center;

                    for card in root.community_cards: Text {
                        text: "[" + card.rank + card.suit + "]";
                        font-size: 18px;
                        color: card.visible ? (card.card_color == "red" ? #cc2222 : #222266) : #2a5a3a;
                    }
                }
            }

            VerticalBox {
                spacing: 4px;
                alignment: center;

                HorizontalBox {
                    spacing: 8px;
                    alignment: center;

                    if root.current_player_name == "You" && !root.animation_active: Text {
                        text: "‚óè";
                        font-size: 14px;
                        color: #00ff00;
                    }

                    Text {
                        text: "You";
                        font-size: 16px;
                        font-weight: 700;
                        color: #4ecdc4;
                    }
                }

                HorizontalBox {
                    spacing: 4px;
                    alignment: center;

                    for card in root.player_cards: HorizontalBox {
                        spacing: 2px;
                        Text {
                            text: "[" + card.rank + card.suit + "]";
                            font-size: 16px;
                            color: card.visible ? (card.card_color == "red" ? #cc2222 : #222266) : #2a5a3a;
                        }
                    }
                }

                HorizontalBox {
                    spacing: 12px;
                    alignment: center;

                    Text {
                        text: "Chips: " + root.player_chips;
                        font-size: 13px;
                        color: #8ecdc4;
                    }

                    Text {
                        text: "Bet: " + root.player_bet;
                        font-size: 13px;
                        color: #ffd700;
                    }
                }

                if root.player_last_action != "": Text {
                    text: root.player_last_action;
                    font-size: 11px;
                    color: #888888;
                    font-italic: true;
                }
            }
        }

        if root.show_actions && !root.animation_active: HorizontalBox {
            padding: 8px;
            spacing: 10px;
            alignment: center;

            if root.can_check: Button {
                text: "Check";
                primary: true;
                clicked => { root.check(); }
            }

            if root.can_call: Button {
                text: "Call";
                primary: true;
                clicked => { root.call(); }
            }

            if root.can_fold: Button {
                text: "Fold ‚úï";
                primary: false;
                clicked => { root.fold(); }
            }

            if root.can_raise: Button {
                text: "Raise ‚Üó";
                primary: true;
                clicked => { root.raise(); }
            }

            Button {
                text: "All-In ‚≠ê";
                primary: true;
                clicked => { root.all_in(); }
            }
        }

        HorizontalBox {
            padding: 8px;
            spacing: 16px;
            alignment: center;

            Button {
                text: "üÉè New Hand";
                primary: false;
                clicked => { root.new_hand(); }
            }
        }

        if root.show_winner: HorizontalBox {
            alignment: center;

            Text {
                text: "üèÜ " + root.winner_name + " WINS THE POT! üèÜ";
                font-size: 22px;
                color: #ffd700;
                font-weight: 800;
            }
        }
    }
}
